
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pneumonia Severity Index (PSI/PORT Score) Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        fieldset { border: 1px solid #CBD5E0; border-radius: 0.5rem; padding: 1rem; margin-bottom: 1.5rem; }
        legend { font-weight: 600; padding: 0 0.5rem; color: #2D3748; }
        .btn { background-color: #2D3748; color: white; font-weight: bold; padding: 0.75rem 1rem; border-radius: 0.375rem; width: 100%; transition: background-color 0.2s; }
        .btn:hover { background-color: #1A202C; }
        .checkbox-label { display: flex; align-items: center; margin-bottom: 0.75rem; padding: 0.5rem; border-radius: 0.375rem; transition: background-color 0.2s; }
        .checkbox-label:hover { background-color: #F7FAFC; }
        .checkbox-label input { height: 1.25rem; width: 1.25rem; color: #2D3748; }
        .checkbox-label span { margin-left: 0.75rem; color: #4A5568; }
        .points { font-size: 0.8rem; color: #718096; margin-left: auto; }
        .input-label { font-weight: 500; color: #4A5568; }
        .input-field {
            border-radius: 0.375rem;
            border: 1px solid #E2E8F0;
            padding: 0.5rem 0.75rem;
            width: 100%;
            transition: border-color 0.2s;
        }
        .input-field:focus {
            outline: none;
            border-color: #4299E1;
            box-shadow: 0 0 0 2px rgba(66, 153, 225, 0.4);
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-3xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-700">Pneumonia Severity Index (PSI)</h1>
            <p class="text-md text-gray-500 mt-2">폐렴 중증도 및 사망률 예측</p>
        </header>

        <main id="calculator-form">
            <!-- 1단계: 초기 평가 -->
            <fieldset>
                <legend class="text-lg">1단계: 초기 평가</legend>
                <div class="mt-4 space-y-3">
                    <label class="checkbox-label"><input type="checkbox" id="initial_over50"><span>나이 > 50세</span></label>
                    <label class="checkbox-label"><input type="checkbox" id="initial_comorbid"><span>동반 질환* 존재</span></label>
                    <label class="checkbox-label"><input type="checkbox" id="initial_vital"><span>활력 징후 또는 의식 상태 이상**</span></label>
                </div>
                 <p class="text-xs text-gray-500 mt-4">* 동반 질환: 암, 간질환, 심부전, 뇌혈관질환, 신장질환<br>** 이상 기준: 의식 혼미, 맥박≥125, 호흡수≥30, 수축기혈압<90, 체온<35℃ 또는 ≥40℃</p>
            </fieldset>

            <!-- 2단계: 점수 계산 -->
            <fieldset>
                <legend class="text-lg">2단계: 상세 점수 계산</legend>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4 mt-4">
                    <!-- 인구학적 정보 -->
                    <div>
                        <h3 class="font-semibold mb-2">인구학적 정보</h3>
                        <div class="space-y-3">
                            <div>
                                <label for="age" class="input-label block mb-1">나이 (세) <span class="font-normal text-gray-500">(+나이 점수)</span></label>
                                <input type="number" id="age" class="input-field" placeholder="나이를 숫자로 입력">
                            </div>
                            <label class="checkbox-label"><input type="checkbox" id="is_female"><span>여성</span><span class="points">-10</span></label>
                            <label class="checkbox-label"><input type="checkbox" data-score="10"><span>요양원 거주</span><span class="points">+10</span></label>
                        </div>
                    </div>
                    <!-- 동반 질환 -->
                    <div>
                        <h3 class="font-semibold mb-2">동반 질환</h3>
                        <label class="checkbox-label"><input type="checkbox" data-score="30"><span>악성 종양</span><span class="points">+30</span></label>
                        <label class="checkbox-label"><input type="checkbox" data-score="20"><span>간 질환</span><span class="points">+20</span></label>
                        <label class="checkbox-label"><input type="checkbox" data-score="10"><span>울혈성 심부전</span><span class="points">+10</span></label>
                        <label class="checkbox-label"><input type="checkbox" data-score="10"><span>뇌혈관 질환</span><span class="points">+10</span></label>
                        <label class="checkbox-label"><input type="checkbox" data-score="10"><span>신장 질환</span><span class="points">+10</span></label>
                    </div>
                    <!-- 신체 검진 -->
                    <div>
                        <h3 class="font-semibold mb-2">신체 검진 소견</h3>
                        <label class="checkbox-label"><input type="checkbox" data-score="20"><span>의식 상태 변화</span><span class="points">+20</span></label>
                        <label class="checkbox-label"><input type="checkbox" data-score="20"><span>호흡수 ≥ 30회/분</span><span class="points">+20</span></label>
                        <label class="checkbox-label"><input type="checkbox" data-score="20"><span>수축기 혈압 < 90mmHg</span><span class="points">+20</span></label>
                        <label class="checkbox-label"><input type="checkbox" data-score="15"><span>체온 < 35℃ 또는 ≥ 40℃</span><span class="points">+15</span></label>
                        <label class="checkbox-label"><input type="checkbox" data-score="10"><span>맥박수 ≥ 125회/분</span><span class="points">+10</span></label>
                    </div>
                    <!-- 검사 소견 -->
                    <div>
                        <h3 class="font-semibold mb-2">검사 소견</h3>
                        <label class="checkbox-label"><input type="checkbox" data-score="30"><span>동맥혈 pH < 7.35</span><span class="points">+30</span></label>
                        <label class="checkbox-label"><input type="checkbox" data-score="30"><span>BUN ≥ 30 mg/dL</span><span class="points">+30</span></label>
                        <label class="checkbox-label"><input type="checkbox" data-score="20"><span>나트륨 < 130 mEq/L</span><span class="points">+20</span></label>
                        <label class="checkbox-label"><input type="checkbox" data-score="10"><span>혈당 ≥ 250 mg/dL</span><span class="points">+10</span></label>
                        <label class="checkbox-label"><input type="checkbox" data-score="10"><span>헤마토크리트 < 30%</span><span class="points">+10</span></label>
                        <label class="checkbox-label"><input type="checkbox" data-score="10"><span>동맥혈 pO₂ < 60 mmHg</span><span class="points">+10</span></label>
                        <label class="checkbox-label"><input type="checkbox" data-score="10"><span>흉부 X선 상 흉수</span><span class="points">+10</span></label>
                    </div>
                </div>
            </fieldset>
            
            <button id="calc-button" class="btn mt-2">점수 계산</button>

            <fieldset class="mt-8">
                <legend class="text-lg">계산 결과</legend>
                <div id="result-text" class="mt-2 p-4 bg-gray-100 rounded-lg min-h-[120px] whitespace-pre-wrap font-mono text-base">결과가 여기에 표시됩니다.</div>
            </fieldset>
        </main>
    </div>

    <script>
        document.getElementById('calc-button').addEventListener('click', () => {
            // 1단계 평가
            const isOver50 = document.getElementById('initial_over50').checked;
            const hasComorbid = document.getElementById('initial_comorbid').checked;
            const hasVitalSignAbnormality = document.getElementById('initial_vital').checked;

            if (!isOver50 && !hasComorbid && !hasVitalSignAbnormality) {
                document.getElementById('result-text').textContent = 
                    `Risk Class: I\n` +
                    `------------------------------------\n` +
                    `사망률: 0.1%\n` +
                    `권고 사항: 외래 치료 고려`;
                return;
            }

            // 2단계 점수 계산
            let score = 0;
            const ageInput = document.getElementById('age');
            const age = parseInt(ageInput.value, 10);
            if (!isNaN(age) && age > 0) {
                score += age;
            } else {
                alert("나이를 올바르게 입력해주세요.");
                return;
            }

            if (document.getElementById('is_female').checked) {
                score -= 10;
            }

            document.querySelectorAll('#calculator-form input[type="checkbox"][data-score]').forEach(cb => {
                if (cb.checked) {
                    score += parseInt(cb.dataset.score, 10);
                }
            });

            let riskClass, mortality, recommendation;
            if (score <= 70) {
                riskClass = "II";
                mortality = "0.6%";
                recommendation = "외래 치료 고려";
            } else if (score <= 90) {
                riskClass = "III";
                mortality = "0.9%";
                recommendation = "단기 입원 또는 외래 집중 관찰";
            } else if (score <= 130) {
                riskClass = "IV";
                mortality = "9.3%";
                recommendation = "입원 치료";
            } else {
                riskClass = "V";
                mortality = "27.0%";
                recommendation = "입원 치료 (중환자실 고려)";
            }

            const resultStr = 
                `PSI/PORT Score: ${score} 점\n` +
                `Risk Class: ${riskClass}\n` +
                `------------------------------------\n` +
                `30일 사망률: ${mortality}\n` +
                `권고 사항: ${recommendation}`;

            document.getElementById('result-text').textContent = resultStr;
        });
    </script>
</body>
</html>
